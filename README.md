# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды


После клонирования проекта установить зависимости:
```
npm install
```
Для запуска проекта в режиме разработки выполнить команду:
```
npm run start
```

или

```
yarn
yarn start
```
## Сборка
Для сборки проекта в продакшен выполнить команду:
```
npm run build
```

или

```
yarn build
```
## Данные и типы данных используемые в проекте

Карточка товара 

```
interface ICard {
    id: string;
    description: string;
    image: string;
    tittle: string;
    category: string;
    price: number;
}
```

Интерфейс для хранения карточек

```
interface IcardsData {
    _cards: ICard[];
    _preview: string | null;
    setCards(cards: ICard[]): void;
    setPreview(item: ICard): void;
}
```

Интерфейс для хранения данных пользователя 

```
interface IuserData {
    _methodPay: methodPay;
    _adress: string;
    _email: string;
    _phone: string;
    _events : IEvents;
}
```

Интерфейс для хранения данных корзины

```
interface IBasket {
    cards: ICard[] | null;
    totalPrice: number;
    counter: number;
}
```

Данные карточки отражаемой в списке карточек на главной странице

```
type TCardItemPage = Pick<ICard, "id" |  "image" | "tittle" | "category" | "price">;
```

Данные карточки при открытии попапа с детальной информацией о карточке

```
type TCard = Pick<ICard, "id" | "description"| "image" | "tittle" | "category" | "price">;
```

Данные карточки в корзине

```
type TCardBasket = Pick<ICard, "id" |"tittle" | "price">;
```

Данные пользователя вводимые на первом шаге при оформлении 

```
type TUserDataOne = Pick<IuserData, "methodPay" | "adress">;
```

Данные пользователя вводимые на втором шаге при оформлении

```
type TUserDataTwo = Pick<IuserData, "email" | "phone">;
```

## Архитектура проекта

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.
Код приложения разделен на слои согласно парадигме MVP:
- Model - слой данных, отвечает за хранение и изменение данных;
- View - слой представления, отвечает за отображение данных на странице;
- Presenter (EventEmitter) - отвечает за связь представления и данных при сработке какого нибудь события, управляя взаимодействием между ними.

### Базовый код

#### Класс Api

Класс реализует методы для взаимодействия с API, обеспечивая базовую логику отправки запросов к серверу. В его конструкторе принимается базовый URL и опциональный объект с глобальными параметрами запроса. Методы класса включают:
 - `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).
 - `handleResponse`-  обрабатывает ответы сервера, преобразуя их в формат JSON и управляя возможными ошибками;
 - `get`- выполняет GET-запросы по указанному URL и возвращает промис с объектом-ответом от сервера;
 - `post`- отправляет данные на сервер в формате JSON по указанному URI. В методе post можно указать тип запроса (POST, PUT, DELETE) в качестве опционального параметра, который по умолчанию равен 'POST'.

#### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Класс представляет собой брокер событий и обеспечивает управление событиями в системе.  
Класс реализует интерфейс IEvents, используя типы TEmitterEvent, TSubscriber и TEventName.  
Основные функции EventEmitter включают возможность установки и снятия слушателей событий, а также вызов слушателей при возникновении события.

Методы, реализуемые классом описаны интерфейсом 'IEvents':
  
 
```
on - Регистрация обработчика для указанного события.
```

```
off -  Удаление ранее зарегистрированного обработчика события.
```

```
emit - Инициализация события c переданными данными.
```

```
onAll - Подписка на все события.
```

```
offAll - Удаление всех зарегистрированных обработчиков событий.
```

```
trigger - Возвращает функцию, которая инициирует указанное событие с переданными аргументами при вызове.
```

### Слой данных (Model)

#### Класс CardData

Класс представляет собой структуру данных для управления коллекцией карт и предоставляет методы для доступа к ним.  

```
cards: ICard[] - массив объектов типа ICard, представляющий коллекцию всех карт. Каждая карта содержит информацию, определённую в типе ICard.;
```

```
preview: string | null -  строка, представляющая id карточки, которую выбрали для просмотра в модальном окне;
```

```
events: IEvents - экземпляр класса EventEmitter, для инициализации событий при изменении данных;
```

Для взаимодействия с данными используются методы:

```
setCards(cards: ICard[]): void; - метод для получения коллекции карт. Принимает массив объектов типа ICard и записывает их в свойство _cards.
```

```
setPreview(item: ICard): void - метод для получения карты из коллекции по её идентификатору. Принимает идентификатор карты в виде строки и возвращает объект ICard, соответствующий этому идентификатору.
```

```
getCards(): ICard[]; - метод для получения коллекции карт. Возвращает текущее значение свойства _cards.
```

#### Класс UserData

Класс представляет собой структуру данных для управления данными пользователя.
```
    methodPay: methodPay; - метод оплаты (оплата картой или наличными).
```
```
    adress: string; - адрес доставки вводимый пользователем.
```
```
    email: string; - электронная почта вводимая пользователем.
```
```
    phone: string; - номер телефона вводимый пользователем.
```
```
    events : IEvents; - экземпляр класса EventEmitter, для инициализации событий при изменении данных.
```

Для взаимодействия с данными используются методы:

```
get MethodPay - метод для получения метода оплаты. Возвращает текущее значение свойства _methodPay.
```
```
set MethodPay(): methodPay; - метод для записи метода оплаты. Принимает значение типа methodPay и записывает его в свойство _methodPay.
```
```
get Adress - метод для получения адреса. Возвращает текущее значение свойства _adress.
```
```
set Adress(): string; - метод для записи адреса. Принимает значение типа string и записывает его в свойство _adress.
```
```
get Email - метод для получения электронной почты. Возвращает текущее значение свойства _email.
```
```
set Email(): string; - метод для записи электронной почты. Принимает значение типа string и записывает его в свойство _email.
```
```
get Phone - метод для получения номера телефона. Возвращает текущее значение свойства _phone.
```
```
set Phone(): string; - метод для записи номера телефона. Принимает значение типа string и записывает его в свойство _phone.
```


#### Класс BasketData

Класс представляет собой корзину для хранения карт (например, товаров) и управления ими. Он включает в себя свойства и методы для работы с картами, отслеживания их количества и общей стоимости.

```
cardsBasket: ICard[] | null - массив объектов типа ICard, представляющий текущие карты в корзине. Если корзина пуста, свойство может быть null.
```

```
totalPrice: number - общая стоимость всех карт в корзине.
```

```
counter: number - общее количество карт в корзине.
```

```
events: IEvents - экземпляр класса EventEmitter, для инициализации событий при изменении данных;
```

Методы, реализуемые классом:  

```
addCard(card: ICard): void: Метод для добавления новой карты в корзину. Принимает объект ICard и добавляет его в массив cards, увеличивая значение totalPrice на стоимость карты и counter на единицу.
```

```
deleteCard(id: string): void: Метод для удаления карты из корзины. Принимает идентификатор карты в виде строки и удаляет соответствующую карту из массива cards, уменьшая значение totalPrice на стоимость удаленной карты и counter на единицу.
```

```
getCardIndex(item: ICard): number; Метод для получения индекса карты. Принимает объект ICard и возвращает его индекс в массиве cardsBasket.
```

```
clearBasket(): void; Метод для очистки корзины. Удаляет все карты из массива cardsBasket, обнуляет значения totalPrice и counter.
```

```
get BasketCounter(): number; Метод для получения количества карт в корзине. Возвращает значение свойства counter.
```

```
get BasketTotalPrice(): number; Метод для получения общей стоимости карт в корзине. Возвращает значение свойства totalPrice.
```

### Слой представления (View)


#### Класс Component<T>
Абстрактный класс который является базовым компонентом и предоставляет инструментарий для работы с DOM в дочерних компонентах.  
Конструктор принимает один параметр - контейнер типа HTMLElement, в котором компонент будет рендериться.

Методы реализуемые компонентом:
```
toggleClass - Переключает класс у элемента.
```
```
setText - Устанавливает текстовое содержимое элемента.
```
```
setDisabled - Устанавливает или снимает блокировку элемента.
```
```
setImage - Устанавливает изображение и альтернативный текст.
```
```
render - Основной метод, который возвращает корневой DOM-элемент компонента.
```


#### Класс Modal<T>

Является компонентом для управления модальными окнами (полной карточки, корзины, заказа, успешного оформления товара). Он наследуется от Component и реализует интерфейс IModalData. Класс предоставляет методы для открытия и закрытия модальных окон, а также для изменения их содержимого.

Свойства
```
_closeButton: HTMLButtonElement - Кнопка для закрытия модального окна.
```

```
_content: HTMLElement - Элемент, содержащий основное содержимое окна.
```
```
events: IEvents - Объект для работы с событиями.
```

Конструктор
```
constructor(container: HTMLElement, events: IEvents) - Инициализирует контейнер, кнопку закрытия и содержимое. Устанавливает обработчики событий для закрытия окна.
```
Методы  
```
set content(value: HTMLElement): Устанавливает новое содержимое окна.
```

```
open() -  Открывает модальное окно, добавляя класс modal_active, и генерирует событие modal:open.
```
```
close() - Закрывает окно, убирая класс modal_active, очищает содержимое и генерирует событие modal:close.
```
```
render(data: IModalData): HTMLElement - Отрисовывает и открывает модальное окно с переданными данными. Возвращает контейнер.
```

#### Класс Card<T>
Класс предназначенный для отображения и управления карточками товара (в каталоге, в попапе и в корзине), а так-же обработку событий пользователя. Реализует интерфейс "ICard". Наследуется от "Component<T>".
Свойства
```
id: string - Идентификатор карточки.
```

```
description: string - Описание карточки.
```

```
image: string - Ссылка на изображение карточки.
```

```
tittle: string - Название карточки.
```

```
category: string - Категория карточки.
```

```
price: number - Цена карточки.
```




#### Класс Basket<T>

Класс предназначенный для отображения и управления корзиной. Реализует интерфейс "IBasket". Наследуется от "Component<T>".

Свойства
```
cardNumber: number - Количество карточек в корзине.
```

``` 
cardsBasket: ICard[] | null - Массив карточек в корзине.
```

``` 
totalPrice: number - Общая стоимость всех карточек в корзине.
```
методы:

```
renderBasket() - Отрисовывает корзину на странице.
```

```
countCards() - Подсчитываети отображает количество карточек в корзине.
```

#### Класс Page<T>
Класс предназначенный для управления и отображения основных элементов страницы, таких как каталог продуктов, счетчик товаров в корзине, а так же позволяющий блокировать прокрутку страницы.

Выполняемые методы:

```
set counter - Устанавливает новое значение счетчика.
```

```
set cardsList - Устанавливает новое значение списка карточек.
```

```
set locked - Блокирует прокрутку страницы.
```


#### Класс Form<T>

Класс предназначенный для отображения и управления формой. Реализует интерфейс "IFormData". Наследуется от "Component<T>".
свойства 

```
methodPay: string - Способ оплаты.
```

```
adress: string - Адрес доставки.
```

```
phone: string - Номер телефона.
```

```
email: string - Электронная почта.
```

методы:

```
set valid(value: boolean) - Устанавливает новое значение валидации.
```

```
renderForm() - Отрисовывает форму на странице.
```
```
setPayMethod() - Устанавливает способ оплаты.
```
```
setAdress() - Устанавливает адрес доставки.
```
```
setPhone() - Устанавливает номер телефона.
```
```
setEmail() - Устанавливает электронную почту.
```

#### Класс Success<T>

Клас отображает окно с данными о успешно оформленном заказе и показывает общую количество списанных деняк. Реализует интерфейс "ISuccess". Наследуется от "Component<T>".

свойства 

```
totalPrice: number - Общая стоимость всех купленных карточек.
```

методы:

```
renderSuccess() - Отрисовывает окно с данными о успешно оформленном заказе.
```

### Слой Presenter

Веб-ларек — это небольшое приложение. Фактически его представлением будет код, расположенный в файле index.ts в корневой папке src. В этом коде всё соединено через колбэки, события компонентов и API. Полноценная реализация возможна по мере разработки приложения.

 "EventEmitter" обеспечивает связь и обмен данными между "Model" и "View".

## Список всех событий которые могут происходить в приложении

```
cards:changed - Обновляет счётчик корзины и устанавливает разметку товаров на главной странице.
```

```
card:selected - Устанавливает ID карточки в превью модели и вызывает событие preview:changed.
```

```
preview:changed - Выводит или обновляет разметку выбранной карточки в открытом модальном окне, добавляет события на кнопки карточки (например, для добавления товара в корзину).
```

```
modal:open - Вызывается при открытии модального окна. Устанавливает значение свойства locked объекта page в true, запрещая пользовательские действия вне модального окна.
```

```
modal:close - Вызывается при закрытии модального окна. Устанавливает значение свойства locked объекта page в false, разблокируя пользовательские действия.
```

```
basket:open - Открывает корзину и отображает её содержимое в модальном окне.
```

```
basket:changed - Изменяет счётчик товаров в корзине на главной странице, общую сумму и разметку карточек в корзине. При этом обновляется список товаров в корзине.
```

```
order:open - Открывает модальное окно с формой первой части заказа с заблокированной кнопкой "Далее", пока данные не будут валидированы.
```
```
order:changed - Устанавливает данные о способе оплаты и адресе доставки в модель и валидирует поля.
```
```
order.*:change  - Обновляет значение указанного поля в форме оформления заказа при срабатывании соответствующего события.
```
```
contacts.*:change - Устанавливает данные о контактной информации (email и телефон) в модель и валидирует поля.
```
```
formErrors:change - Вызывает текстовую ошибку и блокирует кнопку "Далее" при наличии ошибок.
```
```
order:submit - Открывает вторую часть формы заказа и отображает форму контактной информации для завершения оформления заказа.
```
```
contacts:submit - Отправляет контактную информацию и заказ на сервер. При успешной отправке выводит сообщение об успешном оформлении заказа и очищает корзину. Если возникают ошибки, они отображаются в консоли.
```