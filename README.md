# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

После клонирования проекта установить зависимости:

```
npm install
```

Для запуска проекта в режиме разработки выполнить команду:

```
npm run start
```

или

```
yarn
yarn start
```

## Сборка

Для сборки проекта в продакшен выполнить команду:

```
npm run build
```

или

```
yarn build
```

## Данные используемые в проекте

Интерфейс для запросов на сервер

```
	baseUrl: string;
	cdnUrl: string;
	getCard(id: string): Promise<ICard>;
	getCards(): Promise<ICard[]>;
	postOrderData(order: IOrder): Promise<IOrder>;
```

Карточка товара

```
interface ICard {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Интерфейс для хранения данных карточек

```
interface IcardsData {
	cards: ICard[];
	preview: string | null;
	setCards(cards: ICard[]): void;
	setPreview(item: ICard): void;
	getCardById(id: string): ICard;
}
```

Интерфейс для хранения данных корзины

```
interface IBasketData {
	counter: number;
	sumPrice: number;
	cardsBasket: ICard[];
	addCard(item: ICard): void;
	deleteCard(item: ICard): void;
	toggleBasketCard(item: ICard): number;
	getCardIndex(): void;
	clearBasket(): void;
	addCardsToOrder(): void;
}
```

Интерфейс для хранения данных заказа

```
interface IOrderData {
    order: {};
	errors: {};
	setItems(id: string): void;
	setTotal(value: number): void;
	setPayment(value: TmethodPay): void;
	getPayment(): TmethodPay;
	setOrderField(field: keyof TOrderField, value: string): void;
	validateOrder(): void;
	getOrder(): IOrder;
	clearOrder(): void;
}
```

Главная страница

```
interface IPage {
    counter: number;
	gallery: HTMLElement[];
	wrapper: HTMLElement;
	basket: HTMLElement;
}
```

Корзина

```
interface IBasket {
	basketList: HTMLElement[];
	sumPriceConteiner: HTMLElement;
	basketButton: HTMLButtonElement;
	fullCardBasket(num: number): void;
	setSumPriceConteiner(num: number): void;
	clearBasket(): void;
}
```

Форма оформления заказа

```
interface IForm {
    valid: boolean;
    errors: string[];
    clearInputs(): void;
    render(): HTMLElement;
}
```

Интерфейс для хранения данных оформления заказа

```
interface IOrder {
    methodPay: TmethodPay;
    adress: string;
    email: string;
	phone: string;
	total: number;
	items: string[];
}
```

Сообщение об успешном оформлении заказа

```
interface IPageSuccess {
    total: number;
	setTotal(): void;
}
```

## Типы данных

Данные первой стадии оформления заказа

```
TOrderDataOneStep = Pick<IOrder, 'payment' | 'address'>;
```

Данные второй стадии оформления заказа

```
TOrderDataTwoStep = Pick<IOrder, 'email' | 'phone'>;
```

Данные пользователя вводимые при оформлении

```
TOrderField = TOrderDataOneStep & TOrderDataTwoStep;
```

Данные используемые при выборе способа оплаты

```
TmethodPay = 'online' | 'cash' | '';
```

Данные используемые при запросе к серверу

```
TApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```

Данные ошибок при оформлении

```
FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Константы
```
enum EventsEnum {
	CARDS_CHANGE = 'cards:change',
	CARDS_SELECT = 'card:selected',
	PREVIEW_CHANGE = 'preview:changed',
	CARD_BUY = 'card:buy',
	CARD_DELETE = 'card:delete',
	BASKET_OPEN = 'basket:open',
	BASKET_CLOSE = 'basket:close',
	BASKET_CHANGED = 'basket:changed',
	ORDER_OPEN = 'order:open',
	ORDER_CLOSE = 'order:close',
	ORDER_CHANGED = 'order:changed',
	ERRORS_CHANGE = 'formErrors:change',
	ORDER_SUBMIT = 'order:submit',
	CONTACTS_SUBMIT = 'contacts:submit',
	ORDER_SUCCESS = 'success:finished',
	MODAL_OPEN = 'modal:open',
	MODAL_CLOSE = 'modal:close',
}
```
```

```

## Архитектура проекта

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.
Код приложения разделен на слои согласно парадигме MVP:

- Model - слой данных, отвечает за хранение и изменение данных;
- View - слой представления, отвечает за отображение данных на странице;
- Presenter (EventEmitter) - отвечает за связь представления и данных при сработке какого нибудь события, управляя взаимодействием между ними.

### Базовый код

#### Класс Api

Класс реализует методы для взаимодействия с API, обеспечивая базовую логику отправки запросов к серверу. В его конструкторе принимается базовый URL и опциональный объект с глобальными параметрами запроса. Методы класса включают:

- `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).
- `handleResponse`- обрабатывает ответы сервера, преобразуя их в формат JSON и управляя возможными ошибками;
- `get`- выполняет GET-запросы по указанному URL и возвращает промис с объектом-ответом от сервера;
- `post`- отправляет данные на сервер в формате JSON по указанному URI. В методе post можно указать тип запроса (POST, PUT, DELETE) в качестве опционального параметра, который по умолчанию равен 'POST'.

#### Класс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Класс представляет собой брокер событий и обеспечивает управление событиями в системе.
Класс реализует интерфейс IEvents, используя типы TEmitterEvent, TSubscriber и TEventName.
Основные функции EventEmitter включают возможность установки и снятия слушателей событий, а также вызов слушателей при возникновении события.

Методы, реализуемые классом описаны интерфейсом 'IEvents':

```
on - Регистрация обработчика для указанного события.
```

```
off - Удаление ранее зарегистрированного обработчика события.
```

```
emit - Инициализация события c переданными данными.
```

```
onAll - Подписка на все события.
```

```
offAll - Удаление всех зарегистрированных обработчиков событий.
```

```
trigger - Возвращает функцию, которая инициирует указанное событие с переданными аргументами при вызове.
```

### Слой данных (Model)

#### Класс CardsData

Класс представляет собой структуру данных для управления коллекцией карт и предоставляет методы для доступа к ним.

```
cards: ICard[] - массив объектов типа ICard, представляющий коллекцию всех карт. Каждая карта содержит информацию, определённую в типе ICard.;
```

```
preview: string | null - строка, представляющая id карточки, которую выбрали для просмотра в модальном окне;
```

```
events: IEvents - экземпляр класса EventEmitter, для инициализации событий при изменении данных;
```

Для взаимодействия с данными используются методы:

```
setCards(cards: ICard[]): void; - метод для получения коллекции карт. Принимает массив объектов типа ICard и записывает их в свойство \_cards.
```

```
setPreview(item: ICard): void - метод для получения карты из коллекции по её идентификатору. Принимает идентификатор карты в виде строки и возвращает объект ICard, соответствующий этому идентификатору.
```

```
getCardById(): id: string; - метод для получения карточки из коллекции по её идентификатору. Возвращает объект ICard, соответствующий этому идентификатору.
```

#### Класс OrderData

Класс представляет собой структуру для управления данными пользователя, вводимыми пользователем при оформлении заказа и предоставляет методы для доступа к ним.

```
payment: methodPay; - метод оплаты (оплата картой или наличными).
```

```
address: string; - адрес доставки вводимый пользователем.
```

```
email: string; - электронная почта вводимая пользователем.
```

```
phone: string; - номер телефона вводимый пользователем.
```

```
total: number; - общая сумма заказа.
```

```
items: string[]; - массив идентификаторов купленых карточек, для отправки на сервер.
```

Для взаимодействия с данными используются методы:

```
getPayment() - метод для получения метода оплаты. Возвращает текущее значение свойства "getPayment".
```

```
setPayment(value: TmethodPay): methodPay; - метод для записи метода оплаты. Принимает значение типа methodPay и записывает его в свойство "methodPay".
```

```
clearPayment() - очищает способ оплаты
```

```
togglePayment(value: TmethodPay) - переключает способ оплаты
```



```
setItems(id: string) - записывает в массив карточек id выбранных карточек, для отправки на сервер.
```

```
setTotal(value: number) - метод для записи общей суммы. Принимает значение типа number и записывает его в свойство "total".
```

```
setOrderField() - передает название поля и значение которое ввел пользователь для последующей валидации.
```

```
validateOrder() - валидирует форму. Если форма заполнена верно, возвращает false. Если форма заполнена неверно, возвращает true.
```

```
validateEmail(value: string) - валидирует почту пользователя. Если почта введена верно, возвращает false. Если почта введена неверно, возвращает true. И записывает ошибку в свойство "email".
```

```
validatePhone(value: string) - валидирует телефон пользователя. записывает ошибку в свойство "phone".
```
```
getOrder() - возвращает данные заказа.
```

```
clearOrder() - очищает данные заказа
```

#### Класс BasketData

Класс представляет собой структуру данных для хранения информации о карточках в корзине и управления ими. Он включает в себя свойства и методы для работы с картами, отслеживания их количества и общей стоимости.

```
cardsBasket: ICard[] | null - массив объектов типа ICard, представляющий текущие карты в корзине. Если корзина пуста, свойство может быть null.
```

```
sumPrice: number - общая стоимость всех карт в корзине.
```

```
counter: number - общее количество карт в корзине.
```

```
events: IEvents - экземпляр класса EventEmitter, для инициализации событий при изменении данных;
```

Методы, реализуемые классом:

```
set cardsBasket(value: ICard[] | null); Метод для установки значения cardsBasket. Принимает массив объектов типа ICard и устанавливает его в свойство cardsBasket.
```

```
get cardsBasket(): ICard[] | null; Метод для получения значения cardsBasket. Возвращает текущее значение свойства cardsBasket.
```

```
set basketCounter(value: number); Метод для установки значения BasketCounter. Принимает число и устанавливает его в свойство BasketCounter.
```

```
get BasketCounter(): number; Метод для получения значения BasketCounter. Возвращает текущее значение свойства BasketCounter.
```

```
get sumPrice(): number; Метод для получения значения sumPrice. Возвращает текущее значение свойства sumPrice.
```

```
addCard(card: ICard): void: Метод для добавления новой карты в корзину. Принимает объект ICard и добавляет его в массив cardsBasket, увеличивая значение totalPrice на стоимость карты и counter на единицу.
```

```
deleteCard(card: ICard): void: Метод для удаления карты из корзины. Принимает идентификатор карты в виде строки и удаляет соответствующую карту из массива cards, уменьшая значение sumPrice на стоимость удаленной карты и counter на единицу.
```

```
getCardIndex(item: ICard): number; Метод для получения индекса карты. Принимает объект ICard и возвращает его индекс в массиве cardsBasket.
```

```
clearBasket(): void; Метод для очистки корзины. Удаляет все карты из массива cardsBasket, обнуляет значения totalPrice и counter.
```

```
toggleBasketCard(item: Card): void; Метод для переключения состояния кнопки в корзине и добавления/удаления из корзины.
```

```
addCardsToOrder(arr: IOrder): void; Метод для передачи массива карточек в заказ. Принимает массив ICard и добавляет его в свойство items в объекте IOrder.
```

### Слой представления (View)

#### Класс Component<T>

Абстрактный класс который является базовым компонентом и предоставляет инструментарий для работы с DOM в дочерних компонентах.
Конструктор принимает один параметр - контейнер типа HTMLElement, в котором компонент будет рендериться.

Методы реализуемые компонентом:

```
toggleClass - Переключает класс у элемента.
```

```
setText - Устанавливает текстовое содержимое элемента.
```

```
setDisabled - Устанавливает или снимает блокировку элемента.
```

```
setImage - Устанавливает изображение и альтернативный текст.
```

```
render - Основной метод, который возвращает корневой DOM-элемент компонента.
```

#### Класс Modal<T>

Является компонентом для управления модальными окнами (полной карточки, корзины, заказа, успешного оформления товара). Он наследуется от Component и реализует интерфейс IModalData. Класс предоставляет методы для открытия и закрытия модальных окон, а также для изменения их содержимого.

Свойства

```
closeButton: HTMLButtonElement - Кнопка для закрытия модального окна.
```

```
content: HTMLElement - Элемент, содержащий основное содержимое окна.
```

```
events: IEvents - Объект для работы с событиями.
```


```
constructor(container: HTMLElement, events: IEvents) - Инициализирует контейнер, кнопку закрытия и содержимое. Устанавливает обработчики событий для закрытия окна.
```

Методы

```
set content(value: HTMLElement): Устанавливает новое содержимое окна.
```
```
toggleModal(state: boolean = true) - Переключает активность модального окна.
```

```
handleEscape = (evt: KeyboardEvent) => {...} - Обработчик события нажатия на клавишу Escape. Закрывает модальное окно при нажатии на клавишу.
```



```
open() - Открывает модальное окно, добавляя класс modal_active, и генерирует событие modal:open.
```

```
close() - Закрывает окно, убирая класс modal_active, очищает содержимое и генерирует событие modal:close.
```

```
render(data: IModalData): HTMLElement - Отрисовывает и открывает модальное окно с переданными данными. Возвращает контейнер.
```

#### Класс Card<T>

Класс предназначенный для отображения и управления карточками товара (в каталоге, в попапе и в корзине), а так-же обработку событий пользователя. Реализует интерфейс "ICard". Наследуется от "Component<T>".

Свойства

```
id: string - Идентификатор карточки.
```

```
description: string - Описание карточки.
```

```
image: string - Ссылка на изображение карточки.
```

```
tittle: string - Название карточки.
```

```
category: string - Категория карточки.
```

```
price: number - Цена карточки.
```

```
buttonCard: number - Кнопка карточки.
```

```
buttonDelete: number - Кнопка удаления карточки.
```

```
index: number - Индекс карточки в корзине.
```

Методы используемые компонентом:

```
set id (value: string): Устанавливает новый идентификатор карточки.
```

```
get id (value: string): Возвращает текущий идентификатор карточки.
```

```
set description (value: string): Устанавливает новое описание карточки.
```

```
get description (value: string): Возвращает текущее описание карточки.
```

```
set image (value: string): Устанавливает новую ссылку на изображение карточки.
```

```
get image (value: string): Возвращает текущую ссылку на изображение карточки.
```

```
set tittle (value: string): Устанавливает новое название карточки.
```

```
get tittle (value: string): Возвращает текущее название карточки.
```

```
set category (value: string): Устанавливает новую категорию карточки.
```

```
get category (value: string): Возвращает текущую категорию карточки.
```

```
set price (value: number): Устанавливает новую цену карточки, ели переданное значение равно нулю то делает кнопку неактивной.
```

```
get price (value: number): Возвращает текущую цену карточки.
```

```
set buttonCard (value: number): Устанавливает новую текстовое значение кнопки карточки.
```

```
get buttonCard (value: number): Возвращает текущую текстовое значение кнопки карточки.

```

```
set index (value: number): Устанавливает порядковый номер карточки.

```

```

get index (value: number): Возвращает порядковый номер карточки.

```

```
toggleButton (state: boolean = true): Включает или отключает кнопку карточки.
```

#### Класс Basket<T>

Класс предназначенный для отображения и управления корзиной. Реализует интерфейс "IBasket". Наследуется от "Component<T>".

Свойства

```
_basketList: HTMLElement; - элемент списка карточек в корзине.
```

```
_sumPriceConteiner: HTMLElement; - элемент суммы заказа отображаемый в корзине.
```

```
_basketButton: HTMLButtonElement; - кнопка оформления заказа в корзине.
```

методы:

```
set basketList(items: HTMLElement[]) - Метод для отрисовки карт в корзине.
```

```
fullCardBasket(num: number) - Отображает корзину при наличии карточек.
```

```
setSumPriceConteiner(num: number) - Метод для отрисовки текущей суммы в корзине.
```

```
clearBasket() - Метод для очистки корзины.
```

#### Класс Page<T>

Класс предназначенный для управления и отображения основных элементов страницы, таких как каталог продуктов, счетчик товаров в корзине, а так же позволяющий блокировать прокрутку страницы.

Свойства

```
counter: HTMLElement; - отображаемый счетчик товаров в корзине на главной странице.
```

```
gallery: HTMLElement; - отображаемый список карточек на главной странице.
```

```
wrapper: HTMLElement; - элемент блокирующий прокрутку страницы при открытии модального окна.
```

```
basket: HTMLElement; - отображаемый значок корзины.
```

Выполняемые методы:

```
set counter - Устанавливает новое значение счетчика.
```

```
set gallery - Устанавливает новое значение списка карточек.
```

```
set wrapper - Блокирует прокрутку страницы.
```

#### Класс Form<T>

Класс предназначенный для отображения и управления формами. Реализует интерфейс "IForm". Наследуется от "Component<T>".

Свойства

```
button: HTMLButtonElement; - Кнопка "Далее". При клике отображает следующую форму.
```

```
errors: HTMLElement; - Элемент с сообщениями об ошибках.
```

```
valid: boolean; - Состояние валидации.
```

```
inputs: HTMLInputElement[]; - Список полей ввода.
```

методы:

```
onInputChange(field: keyof T, value: string) - Вызывается при изменении полей ввода и передает название поля и значение которое ввел пользователь.
```

```
clearInputs() - Очищает поля ввода.
```

```
set valid (value: boolean) - Устанавливает состояние валидации.
```

```
set errors(value: string) - Устанавливает сообщение об ошибках.
```

```
render(state: Partial<T> & Partial<IForm>) - Отрисовывает форму с учетом состояния валидации, актуальных ошибок и полей ввода прошедших валидацию.
```

#### Класс Order<T>

Клас отображает окно с данными необходимыми для оформленния заказа. Реализует интерфейс "TOrderDataOneStep". Наследуется от "Form<T>".

Свойства

```
buttonOnline: HTMLButtonElement; - Кнопка "Оплата картой".
```

```
buttonCash: HTMLButtonElement; - Кнопка "Оплата наличными".
```

```
formAddress: HTMLInputElement; - Поле для ввода адреса доставки.
```

Методы:

```
toggleOnlinePayment(state: boolean = true) - Выделяет актуальный способ оплаты.
```

```
toggleCashPayment(state: boolean = true) - Выделяет актуальный способ оплаты.
```

```
enablePaymentFocus(value: string) - Выделяет актуальный способ оплаты.
```

```
disablePaymentFocus(item: OrderData) - Снимает выделение с ранее выбранного способа.
```

#### Класс OrderContact<T>

Клас отображает окно с полями для ввода контактных данных необходимыми для оформленния заказа. Реализует интерфейс "TOrderDataTwoStep". Наследуется от "Form<T>".

Свойства

```
phone: HTMLInputElement; - Поле для ввода номера телефона.
```

```
email: HTMLInputElement; - Поле для ввода email.
```

#### Класс Success<T>

Клас отображает окно с данными об успешно оформленном заказе и показывает общее количество списанных деняк. Реализует интерфейс "ISuccess". Наследуется от "Component<T>".

свойства

```
total: number - Общая стоимость всех купленных карточек.
```

```
description: HTMLElement - Элемент отображающий общее количество списанных денешек.
```

```
bayButton: HTMLElement; - Кнопка завершающая оформление заказа и перезагрузки страницы.
```

методы:

```
setTotal(value: number) - Устанавливает общее количество списанных деняк.
```

### Слой Presenter

Веб-ларек — это небольшое приложение. Фактически его представлением будет код, расположенный в файле index.ts в корневой папке src. В этом коде всё соединено через колбэки, события компонентов и API. Полноценная реализация возможна по мере разработки приложения.

"EventEmitter" обеспечивает связь и обмен данными между "Model" и "View".

## Список всех событий которые могут происходить в приложении

```
cards:changed -  Создает карточки из темплейтов и добавляет их в галерею на главной странице.
```

```
card:selected - Устанавливает ID карточки в превью модели и вызывает событие preview:changed.
```

```
preview:changed - Выводит или обновляет разметку выбранной карточки в открытом модальном окне, добавляет события на кнопки карточки (например, для добавления товара в корзину).
```

```
card:buy - Добавляет карточку в корзину.
```

```
card:delete - Удаляет карточку из корзины.
```

```
basket:open - Открывает корзину и отображает её содержимое в модальном окне.
```

```
basket:changed - Изменяет счётчик товаров в корзине на главной странице, общую сумму и разметку карточек в корзине. При этом обновляется список товаров в корзине.
```

```
order:open - Открывает модальное окно с формой первой части заказа с заблокированной кнопкой "Далее", пока данные не будут введены и проверены. Так же передает данные об оформляемых товарах (общую сумму и карточки) в модель данных для отправки на сервер.
```

```
order:changed - Устанавливает данные о способе оплаты и адресе доставки в модель и валидирует поля.
```

```
/\.*\..*:change/ - Обновляет значение указанного поля в форме оформления заказа при срабатывании соответствующего события.Устанавливает данные введенной пользователем информации (адрес, email и телефон) в модель.
```

```
formErrors:change - Вызывает текстовую ошибку и блокирует кнопку "Далее" при наличии ошибок.
```

```
order:submit - Открывает вторую часть формы заказа и отображает форму контактной информации для завершения оформления заказа.
```

```
contacts:submit - Отправляет информацию о заказе на сервер. При успешной отправке выводит сообщение об успешном оформлении заказа передавая общую стоимость заказа. Оочищает данные заказа в orderData и очищает корзину. Если возникают ошибки, они отображаются в консоли.
```

```
success:finished - Перезагружает страницу после успешного оформления заказа.
```

```
modal:open - Вызывается при открытии модального окна. Устанавливает значение свойства locked объекта page в true, запрещая пользовательские действия вне модального окна.
```

```
modal:close - Вызывается при закрытии модального окна. Устанавливает значение свойства locked объекта page в false, разблокируя пользовательские действия. Очищает значения полей ввода в модальном окне.
```
